<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="dist/output.css" />
    <script src="https://code.jquery.com/jquery-3.7.0.min.js" integrity="sha256-2Pmvv0kuTBOenSvLm6bvfBSSHrUJ+3A7x6P5Ebd07/g=" crossorigin="anonymous"></script>
  </head>
  <body>
    <div class="w-[60%] mx-auto mt-7">
      <div>
        <input
          type="text"
          name="search"
          id="searchBox"
          class="border border-stone-800 rounded-md p-1"
        />
        <button
          id="searchButton"
          onclick="search()"
          class="bg-teal-500 text-white mx-auto rounded-lg text-lg w-[20%] p-1 hover:bg-teal-600"
        >
          search
        </button>
        <button
          id="sallaryButton"
          onclick="calcSallary()"
          class="bg-teal-500 text-white mx-auto rounded-lg text-lg w-[20%] p-1 hover:bg-teal-600"
        >
          calculate
        </button>
        <span id="sallary" class="font-semibold"></span>
        <p id="searchResult" class="font-semibold"></p>
      </div>

      <div
        class="border p-10 mt-4 leading-8 border-teal-900 border-2 rounded-md"
      >
        <div id="info"></div>

    </div>

    <script>
      let flag = true;
      let str = "";
      let baseSallary;
      let hourlySallary;
      let pos;
      let info = document.querySelector("#info").innerHTML;
      const searchInput = document.querySelector("#searchBox");
      const editButton = document.querySelector("#editButton");
      let xmlData = [];

      const editAndDel = async () => {
        const response = await fetch("./xmlFile.xml");
        let data = await response.text();
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(data,'text/xml');
        data = data.split("<button>Delete</button><button>Edit</button>");
        const xmlData = xmlDoc.getElementsByTagName('button');
        for (let i = 0; i < data.length; i++) {
          const button = document.createElement('button');
          button.textContent = 'Delete';
          button.addEventListener("click" , () => {
            const preTag = button.previousElementSibling;
            console.log(preTag)
            preTag.innerHTML = '';
            button.innerHTML = '';
          })
          const editButton = document.createElement('button');
          editButton.textContent = 'Edit';
          
          editButton.addEventListener("click",() => {
            const pTags = document.getElementsByTagName('p');
            const inputField = document.createElement('input');
            // pTags[i].outerHTML = inputField;
            inputField.value = pTags[i].textContent;
            pTags[i].parentNode.replaceChild(inputField, pTags[i]);
            inputField.addEventListener("blur", () => {
            const updatedValue = inputField.value;
            const pTag = document.createElement('p');
            pTag.textContent = updatedValue;
            inputField.parentNode.replaceChild(pTag, inputField);
            const xmlData = xmlDoc.getElementsByTagName('p');
            xmlData[i].textContent = updatedValue;
            
            // Convert the XML to string
            // const serializer = new XMLSerializer();
            // const updatedXmlString = serializer.serializeToString(xmlDoc);
            
            // // Send a POST request to update the XML file
            // fetch('server/update.php', {
            //   method: 'POST',
            //   headers: {
            //     'Content-Type': 'application/xml',
            //   },
            //   body: updatedXmlString,
            // })
            // .then(response => response.text())
            // .then(data => {
            //   console.log('XML file updated successfully');
            // })
          });
            // inputField.addEventListener("change" , () => {
            //   let newData = inputField[i].value;
            //   pTags[i].replace(pTags.innerHTML , newData)
            // })
            console.log("edit")
          })
          if(data[i].includes("<button>Delete</button>")){
            console.log(data[i])
            data[i] = data[i].replace("<button>Delete</button>", button.outerHTML);
          }
          if(data[i].includes("<button>Edit</button>")){
            console.log(data[i])
            data[i] = data[i].replace("<button>Edit</button>", editButton.outerHTML);
          }
          document.querySelector("#info").appendChild(button);
          document.querySelector("#info").appendChild(editButton);
          document.querySelector("#info").insertAdjacentHTML('beforeend', data[i]);
        }
      }

      // const edit = async () => {
      //   const response = await fetch("./xmlFile.xml");
      //   let data = await response.text();
      //   const parser = new DOMParser();
      //   const xmlDoc = parser.parseFromString(data, 'text/xml');
      //   data = data.split("<button>Edit</button>");
      //   for (let i = 0; i < data.length; i++) {
      //     const editButton = document.createElement('button');
      //     editButton.textContent = 'Edit';
      //     editButton.addEventListener("click" , () => {
      //       const preTag = editButton.previousElementSibling;
      //       console.log(preTag)
      //     })
      //     if(data[i].includes("<button>Edit</button>")){
      //       console.log(data[i])
      //       data[i] = data[i].replace("<button>Edit</button>", editButton.outerHTML);
      //     }
      //     document.querySelector("#info").appendChild(editButton);
      //     document.querySelector("#info").insertAdjacentHTML('beforeend', data[i]);
      //   }
      // }
      
      const calcSallary = () => {
        xmlData.map((item, index) => {
          pos = item[4];
          console.log(pos);
          if (JSON.stringify(xmlData[index]).includes("basic")) {
            if (pos.includes("front")) {
              baseSallary = 900;
              xmlData.push({ sallary: baseSallary * 40 });
              console.log(xmlData);
              document.querySelector("#sallary").innerHTML =
                "Sallary: " + JSON.stringify(xmlData[1].sallary) + "$";
              console.log(xmlData[1]);
            } else if (pos.includes("back")) {
              baseSallary = 1000;
              xmlData.push({ sallary: baseSallary * 40 });
              console.log(xmlData);
              document.querySelector("#sallary").innerHTML =
                "Sallary: " + JSON.stringify(xmlData[1].sallary) + "$";
              console.log(xmlData[1]);
            } else if (pos.includes("strategist")) {
              baseSallary = 700;
              xmlData.push({ sallary: baseSallary * 40 });
              console.log(xmlData);
              document.querySelector("#sallary").innerHTML =
                "Sallary: " + JSON.stringify(xmlData[1].sallary) + "$";
              console.log(xmlData[1]);
            } else {
              baseSallary = 700;
              xmlData.push({ sallary: baseSallary * 40 });
              console.log(xmlData);
              document.querySelector("#sallary").innerHTML =
                "Sallary: " + JSON.stringify(xmlData[1].sallary) + "$";
              console.log(xmlData[1]);
            }
          } else {
            if (pos.includes("front")) {
              hourlySallary = 800;
              xmlData.push({ sallary: hourlySallary * 40 });
              console.log(xmlData);
              document.querySelector("#sallary").innerHTML =
                "Sallary: " + JSON.stringify(xmlData[1].sallary) + "$";
              console.log(xmlData[1]);
            } else if (pos.includes("back")) {
              hourlySallary = 900;
              xmlData.push({ sallary: hourlySallary * 40 });
              console.log(xmlData);
              document.querySelector("#sallary").innerHTML =
                "Sallary: " + JSON.stringify(xmlData[1].sallary) + "$";
              console.log(xmlData[1]);
            } else if (pos.includes("strategist")) {
              hourlySallary = 600;
              xmlData.push({ sallary: hourlySallary * 40 });
              console.log(xmlData);
              document.querySelector("#sallary").innerHTML =
                "Sallary: " + JSON.stringify(xmlData[1].sallary) + "$";
              console.log(xmlData[1]);
            } else {
              hourlySallary = 600;
              xmlData.push({ sallary: hourlySallary * 40 });
              console.log(xmlData);
              document.querySelector("#sallary").innerHTML =
                "Sallary: " + JSON.stringify(xmlData[1].sallary) + "$";
              console.log(xmlData[1]);
            }
          }
        });
      };

      const search = () => {
        for (let i = 0; i < xmlData.length; i++) {
          if (JSON.stringify(xmlData[i]).includes(searchInput.value)) {
            document.querySelector(
              "#searchResult"
            ).innerHTML = `<span class="text-green-700">User Found</span>`;
          } else {
            document.querySelector(
              "#searchResult"
            ).innerHTML = `<span class="text-red-700">Not Found</span>`;
          }
        }
      };

      if (flag) {
        editAndDel();
        flag = false;
      }
    </script>
  </body>
</html>
